//
// Generated By: dol2asm
// Translation Unit: JSUList
//

#include "JSystem/JSupport/JSUList.h"
#include "dol2asm.h"
#include "dolphin/types.h"

/* 802DBDFC-802DBE14 2D673C 0018+00 0/0 34/34 0/0 .text            __ct__10JSUPtrLinkFPv */
JSUPtrLink::JSUPtrLink(void* object) {
    mList = NULL;
    mObject = object;
    mPrev = NULL;
    mNext = NULL;
}


/* 802DBE14-802DBE74 2D6754 0060+00 0/0 27/27 0/0 .text            __dt__10JSUPtrLinkFv */
JSUPtrLink::~JSUPtrLink() {
    if (mList != NULL) {
        mList->remove(this);
    }
}

/* 802DBE74-802DBEAC 2D67B4 0038+00 0/0 4/4 0/0 .text            __ct__10JSUPtrListFb */
JSUPtrList::JSUPtrList(bool init) {
    if (init) {
        this->initiate();
    }
}

/* 802DBEAC-802DBF14 2D67EC 0068+00 0/0 25/25 0/0 .text            __dt__10JSUPtrListFv */
JSUPtrList::~JSUPtrList() {
    JSUPtrLink* node = mHead;
    s32 removed = 0;
    while (mLength > removed) {
        node->mList = NULL;
        node = node->getNext();
        removed += 1;
    }
}

/* 802DBF14-802DBF28 2D6854 0014+00 1/1 27/27 0/0 .text            initiate__10JSUPtrListFv */
void JSUPtrList::initiate() {
    mHead = NULL;
    mTail = NULL;
    mLength = 0;
}

/* 802DBF28-802DBF4C 2D6868 0024+00 2/2 0/0 0/0 .text setFirst__10JSUPtrListFP10JSUPtrLink */
void JSUPtrList::setFirst(JSUPtrLink* first) {
    first->mList = this;
    first->mPrev = NULL;
    first->mNext = NULL;
    mTail = first;
    mHead = first;
    mLength = 1;
}

/* 802DBF4C-802DBFF0 2D688C 00A4+00 1/1 29/29 0/0 .text append__10JSUPtrListFP10JSUPtrLink */
bool JSUPtrList::append(JSUPtrLink* ptr) {
    JSUPtrList* list = ptr->mList;
    bool result = (NULL == list);
    if (!result) {
        result = list->remove(ptr);
    }

    if (result) {
        if (mLength == 0) {
            setFirst(ptr);
        } else {
            ptr->mList = this;
            ptr->mPrev = mTail;
            ptr->mNext = NULL;
            mTail->mNext = ptr;
            mTail = ptr;
            mLength++;
        }
    }

    return result;
}

/* 802DBFF0-802DC094 2D6930 00A4+00 1/1 8/8 0/0 .text prepend__10JSUPtrListFP10JSUPtrLink */
bool JSUPtrList::prepend(JSUPtrLink* ptr) {
    JSUPtrList* list = ptr->mList;
    bool result = (NULL == list);
    if (!result) {
        result = list->remove(ptr);
    }

    if (result) {
        if (mLength == 0) {
            setFirst(ptr);
        } else {
            ptr->mList = this;
            ptr->mPrev = NULL;
            ptr->mNext = mHead;
            mHead->mPrev = ptr;
            mHead = ptr;
            mLength++;
        }
    }

    return result;
}


/* 802DC094-802DC15C 2D69D4 00C8+00 0/0 4/4 0/0 .text insert__10JSUPtrListFP10JSUPtrLinkP10JSUPtrLink              */
bool JSUPtrList::insert(JSUPtrLink* before, JSUPtrLink* ptr) {
    if (before == mHead) {
        return prepend(ptr);
    } else if (before == NULL) {
        return append(ptr);
    }

    if (before->mList != this) {
        return false;
    }

    bool result = (NULL == ptr->mList);
    if (!result) {
        result = ptr->mList->remove(ptr);
    }

    if (result) {
        JSUPtrLink* prev = before->mPrev;
        ptr->mList = this;
        ptr->mPrev = prev;
        ptr->mNext = before;
        prev->mNext = ptr;
        before->mPrev = ptr;
        mLength++;
    }

    return result;
}

/* 802DC15C-802DC20C 2D6A9C 00B0+00 4/4 31/31 0/0 .text remove__10JSUPtrListFP10JSUPtrLink */
bool JSUPtrList::remove(JSUPtrLink* ptr) {
    bool is_parent = (ptr->mList == this);
    if (is_parent) {
        if (mLength == 1) {
            mHead = NULL;
            mTail = NULL;
        } else if (ptr == mHead) {
            ptr->mNext->mPrev = NULL;
            mHead = ptr->mNext;
        } else if (ptr == mTail) {
            ptr->mPrev->mNext = NULL;
            mTail = ptr->mPrev;
        } else {
            ptr->mPrev->mNext = ptr->mNext;
            ptr->mNext->mPrev = ptr->mPrev;
        }

        ptr->mList = NULL;
        mLength--;
    }

    return is_parent;
}

/* 802DC20C-802DC23C 2D6B4C 0030+00 0/0 3/3 0/0 .text            getNthLink__10JSUPtrListCFUl */
JSUPtrLink* JSUPtrList::getNthLink(u32 index) const {
    if (index >= mLength) {
        return NULL;
    }

    JSUPtrLink* node = mHead;
    for (u32 i = 0; i < index; i++) {
        node = node->getNext();
    }

    return node;
}
